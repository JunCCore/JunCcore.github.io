<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>10个高级的 SQL 查询技巧.</title>
    <link href="/2024/08/23/MySqlSummary04/"/>
    <url>/2024/08/23/MySqlSummary04/</url>
    
    <content type="html"><![CDATA[<h2 id="1、常见表表达式（CTEs）"><a href="#1、常见表表达式（CTEs）" class="headerlink" title="1、常见表表达式（CTEs）"></a>1、常见表表达式（CTEs）</h2><p>如果您想要查询子查询，那就是CTEs施展身手的时候 - CTEs基本上创建了一个临时表。<br>使用常用表表达式（CTEs）是模块化和分解代码的好方法，与您将文章分解为几个段落的方式相同。<br>请在Where子句中使用子查询进行以下查询。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span><br>name,<br>salary<br><span class="hljs-keyword">FROM</span><br>People<br><span class="hljs-keyword">WHERE</span><br>NAMEIN(SELECTDISTINCTNAMEFROMpopulationWHEREcountry<span class="hljs-operator">=</span>&quot;Canada&quot;ANDcity<span class="hljs-operator">=</span>&quot;Toronto&quot;)<br>ANDsalary<span class="hljs-operator">&gt;=</span>(<br><span class="hljs-keyword">SELECT</span><br><span class="hljs-built_in">AVG</span>(salary)<br><span class="hljs-keyword">FROM</span><br>salaries<br><span class="hljs-keyword">WHERE</span><br>gender<span class="hljs-operator">=</span>&quot;Female&quot;)<br></code></pre></td></tr></table></figure><p>这似乎似乎难以理解，但如果在查询中有许多子查询，那么怎么样？这就是CTEs发挥作用的地方。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">with</span> toronto_ppl <span class="hljs-keyword">as</span> (<br>   <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> name<br>   <span class="hljs-keyword">FROM</span> population<br>   <span class="hljs-keyword">WHERE</span> country <span class="hljs-operator">=</span> &quot;Canada&quot;<br>         <span class="hljs-keyword">AND</span> city <span class="hljs-operator">=</span> &quot;Toronto&quot;<br>)<br>, avg_female_salary <span class="hljs-keyword">as</span> (<br>   <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">as</span> avgSalary<br>   <span class="hljs-keyword">FROM</span> salaries<br>   <span class="hljs-keyword">WHERE</span> gender <span class="hljs-operator">=</span> &quot;Female&quot;<br>)<br><span class="hljs-keyword">SELECT</span> name<br>       , salary<br><span class="hljs-keyword">FROM</span> People<br><span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">FROM</span> toronto_ppl)<br>      <span class="hljs-keyword">AND</span> salary <span class="hljs-operator">&gt;=</span> (<span class="hljs-keyword">SELECT</span> avgSalary <span class="hljs-keyword">FROM</span> avg_female_salary)<br></code></pre></td></tr></table></figure><p>现在很清楚，Where子句是在多伦多的名称中过滤。如果您注意到，CTE很有用，因为您可以将代码分解为较小的块，但它们也很有用，因为它允许您为每个CTE分配变量名称（即toronto_ppl和avg_female_salary）同样，CTEs允许您完成更高级的技术，如创建递归表。</p><h2 id="2-递归CTEs"><a href="#2-递归CTEs" class="headerlink" title="2 递归CTEs."></a>2 递归CTEs.</h2><p>递归CTE是引用自己的CTE，就像Python中的递归函数一样。递归CTE尤其有用，它涉及查询组织结构图，文件系统，网页之间的链接图等的分层数据，尤其有用。递归CTE有3个部分：<br>锚构件：返回CTE的基本结果的初始查询递归成员：引用CTE的递归查询。这是所有与锚构件的联盟停止递归构件的终止条件以下是获取每个员工ID的管理器ID的递归CTE的示例：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">with</span>  org_structure  <span class="hljs-keyword">as</span>  (<br>      <span class="hljs-keyword">SELECT</span>  id,  manager_id<br>      <span class="hljs-keyword">FROM</span>  staff_members<br>      <span class="hljs-keyword">WHERE</span>  manager_id  <span class="hljs-keyword">IS</span>  <span class="hljs-keyword">NULL</span><br>      <span class="hljs-keyword">UNION</span>  <span class="hljs-keyword">ALL</span><br>      <span class="hljs-keyword">SELECT</span>  sm.id,  sm.manager_id<br>      <span class="hljs-keyword">FROM</span>  staff_members  sm<br>      <span class="hljs-keyword">INNER</span>  <span class="hljs-keyword">JOIN</span>  org_structure  os<br>    <span class="hljs-keyword">ON</span>  os.id  <span class="hljs-operator">=</span>  sm.manager_id<br><br></code></pre></td></tr></table></figure><h2 id="3、临时函数"><a href="#3、临时函数" class="headerlink" title="3、临时函数"></a>3、临时函数</h2><pre><code class="hljs">如果您想了解有关临时函数的更多信息，请检查此项，但知道如何编写临时功能是重要的原因：</code></pre><p>1.它允许您将代码的块分解为较小的代码块<br>2.它适用于写入清洁代码<br>3.它可以防止重复，并允许您重用类似于使用Python中的函数的代码。</p><p>考虑以下示例：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, <br>       <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-operator">&lt;</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> &quot;analyst&quot;<br>          <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3</span> <span class="hljs-keyword">THEN</span> &quot;associate&quot;<br>          <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> &quot;senior&quot;<br>          <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> &quot;vp&quot;<br>          <span class="hljs-keyword">ELSE</span> &quot;n/a&quot;<br>     <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> seniority <br><span class="hljs-keyword">FROM</span> employees<br></code></pre></td></tr></table></figure><p>临时函数来捕获案例子句:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> TEMPORARY <span class="hljs-keyword">FUNCTION</span> get_seniority(tenure INT64) <span class="hljs-keyword">AS</span> (<br>   <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-operator">&lt;</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> &quot;analyst&quot;<br>        <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3</span> <span class="hljs-keyword">THEN</span> &quot;associate&quot;<br>        <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> &quot;senior&quot;<br>        <span class="hljs-keyword">WHEN</span> tenure <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> &quot;vp&quot;<br>        <span class="hljs-keyword">ELSE</span> &quot;n/a&quot;<br>   <span class="hljs-keyword">END</span><br>);<br><span class="hljs-keyword">SELECT</span> name<br>       , get_seniority(tenure) <span class="hljs-keyword">as</span> seniority<br><span class="hljs-keyword">FROM</span> employees<br></code></pre></td></tr></table></figure><h2 id="4-Rank-vs-Dense-Rank-vs-Row-Number"><a href="#4-Rank-vs-Dense-Rank-vs-Row-Number" class="headerlink" title="4 Rank vs Dense Rank vs Row Number"></a>4 Rank vs Dense Rank vs Row Number</h2><p>在SQL中，您可以使用几种方式将“等级”分配给行，我们将使用示例进行探索。考虑以下Query和结果：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>  Name    <br>  ,  GPA    <br>  ,  <span class="hljs-built_in">ROW_NUMBER</span>()  <span class="hljs-keyword">OVER</span>  (<span class="hljs-keyword">ORDER</span>  <span class="hljs-keyword">BY</span>  GPA  <span class="hljs-keyword">desc</span>)    <br>  ,  <span class="hljs-built_in">RANK</span>()  <span class="hljs-keyword">OVER</span>  (<span class="hljs-keyword">ORDER</span>  <span class="hljs-keyword">BY</span>  GPA  <span class="hljs-keyword">desc</span>)    <br>  ,  <span class="hljs-built_in">DENSE_RANK</span>()  <span class="hljs-keyword">OVER</span>  (<span class="hljs-keyword">ORDER</span>  <span class="hljs-keyword">BY</span>  GPA  <span class="hljs-keyword">desc</span>)    <br><span class="hljs-keyword">FROM</span>  student_grades<br></code></pre></td></tr></table></figure><p>ROW_NUMBER()返回每行开始的唯一编号。当存在关系时（例如，BOB vs Carrie），ROW_NUMBER()如果未定义第二条标准，则任意分配数字。Rank()返回从1开始的每行的唯一编号，除了有关系时，Rank()将分配相同的数字。同样，差距将遵循重复的等级。dense_rank()类似于Rank()，除了重复等级后没有间隙。请注意，使用dense_rank()，Daniel排名第3，而不是第4位。</p>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySql无法删除主键？</title>
    <link href="/2024/08/10/MySqlSummary03/"/>
    <url>/2024/08/10/MySqlSummary03/</url>
    
    <content type="html"><![CDATA[<h2 id="1、问题背景"><a href="#1、问题背景" class="headerlink" title="1、问题背景"></a>1、问题背景</h2><pre><code class="hljs">同事咨询了一个问题，TD-SQL （for MySQL）中的某张表主键需要改为联合主键，是否必须先删除现有的主键？因为删除主键时，</code></pre><p>提示这个错误。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">[test]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test <span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> key;<br><br>ERROR <span class="hljs-number">3750</span> (HY000): Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> change a <span class="hljs-keyword">table</span> <span class="hljs-keyword">without</span> a <span class="hljs-keyword">primary</span> key, <br><span class="hljs-keyword">when</span> the <span class="hljs-keyword">system</span> variable <span class="hljs-string">&#x27;sql_require_primary_key&#x27;</span> <span class="hljs-keyword">is</span> set. <br><span class="hljs-keyword">Add</span> a <span class="hljs-keyword">primary</span> key <span class="hljs-keyword">to</span> the <span class="hljs-keyword">table</span> <span class="hljs-keyword">or</span> unset this variable <span class="hljs-keyword">to</span> avoid this message. <br>Note that tables <span class="hljs-keyword">without</span> a <span class="hljs-keyword">primary</span> key can cause performance problems <span class="hljs-keyword">in</span> <span class="hljs-type">row</span><span class="hljs-operator">-</span>based replication, <br>so please consult your DBA before changing this setting.<br></code></pre></td></tr></table></figure><h2 id="2、问题分析"><a href="#2、问题分析" class="headerlink" title="2、问题分析"></a>2、问题分析</h2><pre><code class="hljs">从提示上可以看到具体的原因，当设置了 sql_require_primary_key 参数，不能创建或改变一张没有主键的表。</code></pre><p>解决方案是增加主键或者删除此参数避免错误，同时提醒了，如果表无主键，可能会导致基于行的复制产生性能问题。</p><p>&#x2F;<em>sql_require_primary_key</em>&#x2F; 参数控制的是强制检查主键，可以动态修改。</p><h3 id="参数释意"><a href="#参数释意" class="headerlink" title="参数释意"></a>参数释意</h3><p>参数名称：sql_require_primary_key<br>作用范围：Global &amp; Session<br>动态修改：Yes<br>默认值：OFF<br>该参数设置为 ON 时，SQL 语句 create table 创建新表或者 alter 语句时，对已存在的表进行修改，将会强制检查表中是否包含主键，如果没有主键，则会报错。</p><h2 id="3、解决方案"><a href="#3、解决方案" class="headerlink" title="3、解决方案"></a>3、解决方案</h2><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><pre><code class="hljs">既然 sql_require_primary_key 参数控制了强制检验主键，而且又是可动态修改的，临时关闭，再打开即可。</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql">bisal<span class="hljs-variable">@mysqldb</span>:  [test]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t_primary_key <span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> key;<br>ERROR <span class="hljs-number">3750</span> (HY000): Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> change a <span class="hljs-keyword">table</span> <span class="hljs-keyword">without</span> a <span class="hljs-keyword">primary</span> key, <span class="hljs-keyword">when</span> the <span class="hljs-keyword">system</span> variable <span class="hljs-string">&#x27;sql_require_primary_key&#x27;</span> <span class="hljs-keyword">is</span> set. <span class="hljs-keyword">Add</span> a <span class="hljs-keyword">primary</span> key <span class="hljs-keyword">to</span> the <span class="hljs-keyword">table</span> <span class="hljs-keyword">or</span> unset this variable <span class="hljs-keyword">to</span> avo<br><br>bisal<span class="hljs-variable">@mysqldb</span>:  [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%sql_require%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name           <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------+</span><br><span class="hljs-operator">|</span> sql_require_primary_key <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>bisal<span class="hljs-variable">@mysqldb</span>:  [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> sql_require_primary_key <span class="hljs-operator">=</span> <span class="hljs-keyword">ON</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.02</span> sec)<br><br>bisal<span class="hljs-variable">@mysqldb</span>:  [(<span class="hljs-keyword">none</span>)]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%sql_require%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name           <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------+</span><br><span class="hljs-operator">|</span> sql_require_primary_key <span class="hljs-operator">|</span> OFF    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>bisal<span class="hljs-variable">@mysqldb</span>:  [test]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t_primary_key <span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> key;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.10</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><pre><code class="hljs">如果 sql_require_primary_key 设置为 ON，意思就是表任何的时刻都需要有主键，不能出现真空。变更主键的操作，</code></pre><p>实际包含了删除原主键和创建新的主键两个步骤，因此只需要将两个步骤合并成一个即可。<br>MySQL 支持多个语句一次执行，因此只需要将 alter table … drop primary key 和 add constraint … primary key … 合成一条语句。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">bisal<span class="hljs-variable">@mysqldb</span>:  [test]<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t_primary_key <span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> key, <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> pk_t_01 <span class="hljs-keyword">primary</span> key (id, c1);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.06</span> sec)<br>Records: <span class="hljs-number">0</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><pre><code class="hljs">从这个问题可以看出来，MySQL 的参数控制粒度很细，但通过各种应对方法，可以针对性解决特定的场景问题，</code></pre><p>但前提还是对参数的意义，以及场景的需求能充分了解，才能找到合适的解决方案。</p>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>如何优化慢Sql？</title>
    <link href="/2024/04/01/MySqlSummary02/"/>
    <url>/2024/04/01/MySqlSummary02/</url>
    
    <content type="html"><![CDATA[<h2 id="MySql-业务系统查询过程中如何优化慢SQL？"><a href="#MySql-业务系统查询过程中如何优化慢SQL？" class="headerlink" title="MySql  业务系统查询过程中如何优化慢SQL？"></a>MySql  业务系统查询过程中如何优化慢SQL？</h2><pre><code class="hljs"> 以下重点讨论explain 分析慢sql的过程。   </code></pre><h3 id="1、通过慢查日志等定位那些执行效率较低的-SQL-语句"><a href="#1、通过慢查日志等定位那些执行效率较低的-SQL-语句" class="headerlink" title="1、通过慢查日志等定位那些执行效率较低的 SQL 语句"></a>1、通过慢查日志等定位那些执行效率较低的 SQL 语句</h3><h3 id="2、-explain-分析SQL的执行计划"><a href="#2、-explain-分析SQL的执行计划" class="headerlink" title="2、 explain 分析SQL的执行计划"></a>2、 explain 分析SQL的执行计划</h3><blockquote><p>执行计划需要重点关注的内容 ：type、rows、filtered、extra.</p></blockquote><h4 id="2-1、-type-由上至下，效率越来越高："><a href="#2-1、-type-由上至下，效率越来越高：" class="headerlink" title="2.1、 type 由上至下，效率越来越高："></a>2.1、 type 由上至下，效率越来越高：</h4><pre><code class="hljs">ALL 全表扫描  index 索引全扫描  range 索引范围扫描，常用语&lt;,&lt;=,&gt;=,between,in 等操作  ref 使用非唯一索引扫描或唯一索引前缀扫描，返回单条记录，常出现在关联查询中eq_ref 类似 ref，区别在于使用的是唯一索引，使用主键的关联查询const/system 单条记录，系统会把匹配行中的其他列作为常数处理，如主键或唯一索引查询  null MySQL 不访问任何表或索引，直接返回结果 </code></pre><p>&#x2F;<em>虽然上至下</em>&#x2F;，效率越来越高，但是根据 cost 模型，假设有两个索引 idx1(a, b, c),idx2(a, c)，SQL 为”select * from t where a &#x3D; 1 and b in (1, 2) order by c”;如果走 idx1，那么是 type 为 range，如果走 idx2，那么 type 是 ref；当需要扫描的行数，使用 idx2 大约是 idx1 的 5 倍以上时，会用 idx1，否则会用 idx2</p><h4 id="2-2、Extra"><a href="#2-2、Extra" class="headerlink" title="2.2、Extra"></a>2.2、Extra</h4><pre><code class="hljs">Using filesort：MySQL 需要额外的一次传递，以找出如何按排序顺序检索行。通过根据联接类型浏览所有行并为所有匹配 WHERE 子句的行保存排序关键字和行的指针来完成排序。然后关键字被排序，并按排序顺序检索行；  Using temporary：使用了临时表保存中间结果，性能特别差，需要重点优化；    Using index：表示相应的 select 操作中使用了覆盖索引（Coveing Index）,避免访问了表的数据行，效率不错！如果同时出现 using where，意味着无法直接通过索引查找来查询到符合条件的数据；    Using index condition：MySQL5.6 之后新增的 ICP，using index condtion 就是使用了 ICP（索引下推），在存储引擎层进行数据过滤，而不是在服务层过滤，利用索引现有的数据减少回表的数据。</code></pre><h3 id="3、show-profile-分析"><a href="#3、show-profile-分析" class="headerlink" title="3、show profile 分析"></a>3、show profile 分析</h3><pre><code class="hljs">了解 SQL 执行的线程的状态及消耗的时间。默认是关闭的，开启语句“set profiling = 1;”</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> PROFILES ;<br><span class="hljs-keyword">SHOW</span> PROFILE <span class="hljs-keyword">FOR</span> QUERY  #&#123;id&#125;;<br></code></pre></td></tr></table></figure><h3 id="4、trace"><a href="#4、trace" class="headerlink" title="4、trace"></a>4、trace</h3><pre><code class="hljs">分析优化器如何选择执行计划，通过 trace 文件能够进一步了解为什么又会选择 A 执行计划而不选择 B 执行计划。</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> optimizer_trace<span class="hljs-operator">=</span>&quot;enabled=on&quot;;<br><span class="hljs-keyword">set</span> optimizer_trace_max_mem_size<span class="hljs-operator">=</span><span class="hljs-number">1000000</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> information_schema.optimizer_trace;<br></code></pre></td></tr></table></figure><h3 id="5、确定问题并采用相应的措施"><a href="#5、确定问题并采用相应的措施" class="headerlink" title="5、确定问题并采用相应的措施"></a>5、确定问题并采用相应的措施</h3><pre><code class="hljs">如下：优化索引优化 SQL 语句：修改 SQL、IN 查询分段、时间查询分段、基于上一次数据过滤改用其他实现方式：ES、数仓等数据碎片处理</code></pre><h3 id="6、场景分析"><a href="#6、场景分析" class="headerlink" title="6、场景分析"></a>6、场景分析</h3><p>索引生效原则分析</p><h4 id="6-1-最左匹配"><a href="#6-1-最左匹配" class="headerlink" title="6.1  最左匹配"></a>6.1  最左匹配</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 最左匹配</span><br><span class="hljs-comment">-- 索引</span><br>KEY `idx_shopid_orderno` (`shop_id`,`order_no`)<br><br><span class="hljs-comment">-- sql 语句</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _t <span class="hljs-keyword">where</span> orderno<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment">-- 查询匹配从左往右匹配，要使用 order_no 走索引，必须查询条件携带 shop_id 或者索引（shop_id，order_no）调换前后顺序。</span><br></code></pre></td></tr></table></figure><h4 id="6-2-隐式转换"><a href="#6-2-隐式转换" class="headerlink" title="6.2 隐式转换"></a>6.2 隐式转换</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 索引</span><br>KEY `idx_mobile` (`mobile`)<br><br><span class="hljs-comment">-- sql 语句</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _user <span class="hljs-keyword">where</span> mobile<span class="hljs-operator">=</span><span class="hljs-number">12345678901</span><br><span class="hljs-comment">-- 隐式转换相当于在索引上做运算，会让索引失效。mobile 是字符类型，使用了数字，应该使用字符串匹配，否则 MySQL 会用到隐式替换，导致索引失效。</span><br></code></pre></td></tr></table></figure><h4 id="6-3-大分页"><a href="#6-3-大分页" class="headerlink" title="6.3 大分页"></a>6.3 大分页</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 索引</span><br>KEY `idx_a_b_c` (`a`, `b`, `c`)<br><br><span class="hljs-comment">-- sql 语句</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _t <span class="hljs-keyword">where</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> c <span class="hljs-keyword">desc</span> limit <span class="hljs-number">10000</span>, <span class="hljs-number">10</span>;<br><span class="hljs-comment">-- 对于大分页的场景，可以优先让产品优化需求，如果没有优化的，有如下两种优化方式：  </span><br><span class="hljs-comment">--（1）一种是把上一次的最后一条数据，也即上面的 c 传过来，然后做“c &lt; xxx”处理，但是这种一般需要改接口协议，并不一定可行</span><br><span class="hljs-comment">--（2）另一种是采用延迟关联的方式进行处理，减少 SQL 回表，但是要记得索引需要完全覆盖才有效果。</span><br><br><span class="hljs-comment">-- 修改如下：</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _order <span class="hljs-keyword">where</span> shop_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> order_status <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> created_at <span class="hljs-keyword">desc</span> limit <span class="hljs-number">10</span><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">in 查询在 MySQL 底层是通过 n*m 的方式去搜索，类似 union，但是效率比 union 高。in 查询在进行 cost 代价计算时（代价 = 元组数 * IO 平均值），是通过将 in 包含的数值，一条条去查询获取元组数的，因此这个计算过程会比较的慢。所以 MySQL 设置了个临界值（eq_range_index_dive_limit），5.6 之后超过这个临界值后该列的 cost 就不参与计算了。因此会导致执行计划选择不准确。默认是 200，即 in 条件超过了 200 个数据，会导致 in 的代价计算存在问题，可能会导致 MySQL 选择的索引不准确。处理方式：可以（order_status，created_at）互换前后顺序，并且调整 SQL 为延迟关联。</code></pre><h4 id="6-4-范围查询阻断，后续字段不能走索引"><a href="#6-4-范围查询阻断，后续字段不能走索引" class="headerlink" title="6.4 范围查询阻断，后续字段不能走索引"></a>6.4 范围查询阻断，后续字段不能走索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 索引</span><br>KEY `idx_shopid_created_status` (`shop_id`, `created_at`, `order_status`)<br><br><span class="hljs-comment">-- sql 语句</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _order <span class="hljs-keyword">where</span> shop_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> created_at <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2021-01-01 00:00:00&#x27;</span> <span class="hljs-keyword">and</span> order_status <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment">-- 范围查询还有“IN、between”。</span><br></code></pre></td></tr></table></figure><h4 id="6-5-in-order-by-查询"><a href="#6-5-in-order-by-查询" class="headerlink" title="6.5 in + order by 查询"></a>6.5 in + order by 查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment">-- 索引</span><br>KEY `idx_shopid_status_created` (`shop_id`, `order_status`, `created_at`)<br><br><span class="hljs-comment">-- sql 语句</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _order <span class="hljs-keyword">where</span> shop_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> order_status <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> created_at <span class="hljs-keyword">desc</span> limit <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>in 查询在 MySQL 底层是通过 n*m 的方式去搜索，类似 union，但是效率比 union 高。<br>in 查询在进行 cost 代价计算时（代价 &#x3D; 元组数 * IO 平均值），是通过将 in 包含的数值，一条条去查询获取元组数的，因此这个计算过程会比较的慢。<br>所以 MySQL 设置了个临界值（eq_range_index_dive_limit），5.6 之后超过这个临界值后该列的 cost 就不参与计算了。因此会导致执行计划选择不准确。<br>默认是 200，即 in 条件超过了 200 个数据，会导致 in 的代价计算存在问题，可能会导致 MySQL 选择的索引不准确。<br>处理方式：可以（order_status，created_at）互换前后顺序，并且调整 SQL 为延迟关联。  </p><h4 id="6-6-不等于、不包含不能用到索引的快速检索"><a href="#6-6-不等于、不包含不能用到索引的快速检索" class="headerlink" title="6.6 不等于、不包含不能用到索引的快速检索"></a>6.6 不等于、不包含不能用到索引的快速检索</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _order <span class="hljs-keyword">where</span> shop_id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> order_status <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _order <span class="hljs-keyword">where</span> shop_id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> order_status <span class="hljs-operator">!=</span> <span class="hljs-number">1</span><br><span class="hljs-comment">-- 在索引上，避免使用 NOT、!=、&lt;&gt;、!&lt;、!&gt;、NOT EXISTS、NOT IN、NOT LIKE等。</span><br></code></pre></td></tr></table></figure><h4 id="6-7-优化器选择不使用索引的情况"><a href="#6-7-优化器选择不使用索引的情况" class="headerlink" title="6.7 优化器选择不使用索引的情况"></a>6.7 优化器选择不使用索引的情况</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- sql 语句</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _order <span class="hljs-keyword">where</span>  order_status <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>如果要求访问的数据量很小，则优化器还是会选择辅助索引，但是当访问的数据占整个表中数据的蛮大一部分时（一般是 20% 左右），优化器会选择通过聚集索引来查找数据。</p><h4 id="6-8-复杂查询"><a href="#6-8-复杂查询" class="headerlink" title="6.8 复杂查询"></a>6.8 复杂查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(amt) <span class="hljs-keyword">from</span> _t <span class="hljs-keyword">where</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> b <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-keyword">and</span> c <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2020-01-01&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _t <span class="hljs-keyword">where</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> b <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-keyword">and</span> c <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2020-01-01&#x27;</span> limit <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>如果是统计某些数据，可能改用数仓进行解决；如果是业务上就有那么复杂的查询，可能就不建议继续走 SQL 了，而是采用其他的方式进行解决，比如使用 ES 等进行解决。</p><h4 id="6-9-asc-和-desc-混用"><a href="#6-9-asc-和-desc-混用" class="headerlink" title="6.9 asc 和 desc 混用"></a>6.9 asc 和 desc 混用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> _t <span class="hljs-keyword">where</span> a<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> b <span class="hljs-keyword">desc</span>, c <span class="hljs-keyword">asc</span><br><span class="hljs-comment">-- desc 和 asc 混用时会导致索引失效。</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySql  int(1) 和 int(10) 有什么区别？</title>
    <link href="/2024/03/29/MySqlSummary01/"/>
    <url>/2024/03/29/MySqlSummary01/</url>
    
    <content type="html"><![CDATA[<h2 id="MySql-int-1-和-int-10-有什么区别？"><a href="#MySql-int-1-和-int-10-有什么区别？" class="headerlink" title="MySql  int(1) 和 int(10) 有什么区别？"></a>MySql  int(1) 和 int(10) 有什么区别？</h2><p>MySql 知识点总结之（int(1) 和 int(10) 有什么区别？）</p><h4 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h4><p>正常来说，没有区别。 后面带的数字，并不是长度的概念。 Int 类型就是占用4个字节（32位）， Int(1), int(10) 都一样是4个字节&#x2F;32位，数据范围也还是-2^31 ~ 2^31-1。</p><h4 id="困惑"><a href="#困惑" class="headerlink" title="困惑"></a>困惑</h4><p>对于日常建表过程中，大家普遍认为在使用过程中int(10)通常表示数值长度的位数；包括我经常在也看到同事也一直使用int(10)，感觉用了int(1)，字段的上限就被限制，真实情况肯定不是这样。</p><h4 id="数据说话"><a href="#数据说话" class="headerlink" title="数据说话"></a>数据说话</h4><p>我们知道在mysql中 int占4个字节，那么对于无符号的int，最大值是2^32-1 &#x3D; 4294967295，将近40亿，难道用了int(1)，就不能达到这个最大值吗？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">1</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>   <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br></code></pre></td></tr></table></figure><p>id字段为无符号的int(1)，我来插入一个最大值看看。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">user</span>` (`id`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4294967295</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>可以看到成功了，说明int后面的数字，不影响int本身支持的大小，int(1)、int(2)…int(10)没什么区别。</p><h4 id="官方解释"><a href="#官方解释" class="headerlink" title="官方解释"></a>官方解释</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-type">int</span>(M): M indicates the maximum display width <span class="hljs-keyword">for</span> <span class="hljs-type">integer</span> types.<br></code></pre></td></tr></table></figure><p>翻译过来就是，在 integer 数据类型中，M 表示最大显示宽度。</p><p>也就是说，在 int(M) 中，M 的值跟 int(M) 所占多少存储空间并无任何关系。 int(3)、int(4)、int(8) 在磁盘上都是占用4 bytes的存储空间。说白了，除了显示给用户的方式有点不同外，int(M) 跟 int 数据类型是相同的。</p><p>另外，int(M) 只有跟</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">zerofill<br></code></pre></td></tr></table></figure><p>结合起来，才能更清楚的看到它的具体含义。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t(id <span class="hljs-type">int</span> zerofill);<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t(id) <span class="hljs-keyword">values</span>(<span class="hljs-number">10</span>);<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------+</span><br><span class="hljs-operator">|</span> id         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">0000000010</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------+</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t change <span class="hljs-keyword">column</span> id <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) zerofill;<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span> id   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">0010</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+</span><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t(id) <span class="hljs-keyword">values</span>(<span class="hljs-number">1000000</span>);<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------+</span><br><span class="hljs-operator">|</span> id      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+</span><br><span class="hljs-operator">|</span>    <span class="hljs-number">0010</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1000000</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------+</span><br></code></pre></td></tr></table></figure><p>从上面的测试可以看出，“(M)”指定了 int 型数值显示的宽度，如果字段数据类型是 int(4)，那么当显示数值 10 时，在左边要补上 “00”；当显示数值 100 是，在左边要补上“0”；当显示数值 1000000 时，已经超过了指定宽度“（4）”，因此按原样输出。</p><p>因此，在使用 MySQL 数据类型中的整数类型（tinyint、smallint、 mediumint、 int&#x2F;integer、bigint）时，非特殊需求下，在数据类型后加个“(M)”，是没有任何意义的。</p><p>int(1)和int(11)在实际使用中，如果不使用 zerofill 是没有任何区别的，而且int型最大只能存储4294967295这个整数，也就是只有10位。</p><h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>综上所述，当我们需要用整形来存储一个字段类型的时候，应该尽量估算出该字段所需要的实际长度，比如tinyint可存储无符号最大值是255（1个字节长度，即2的8次方），smallint可存储无符号最大值是65535（2个字节长度，即2的16次方），mediumint可存储无符号最大值是16777215（3个字节长度，即2的24次方），而int型最大可存储4294967295（3个字节长度，即2的32次方）。</p>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java 运行时内存分析</title>
    <link href="/2024/03/29/Java/JavaSummary01/"/>
    <url>/2024/03/29/Java/JavaSummary01/</url>
    
    <content type="html"><![CDATA[<h2 id="Java-运行时内存总结？"><a href="#Java-运行时内存总结？" class="headerlink" title="Java 运行时内存总结？"></a>Java 运行时内存总结？</h2><p><img src="/img/java_class.jpg" alt="Example Image" title="Example Title"></p>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>markdown 编辑指南</title>
    <link href="/2024/03/20/markdownlearning/"/>
    <url>/2024/03/20/markdownlearning/</url>
    
    <content type="html"><![CDATA[<h2 id="欢迎使用-Cmd-Markdown-编辑指南"><a href="#欢迎使用-Cmd-Markdown-编辑指南" class="headerlink" title="欢迎使用 Cmd Markdown 编辑指南"></a>欢迎使用 Cmd Markdown 编辑指南</h2><hr><h4 id="本文内容是引用学习-markdown-语法手册"><a href="#本文内容是引用学习-markdown-语法手册" class="headerlink" title="本文内容是引用学习 markdown 语法手册"></a><a href="https://www.zybuluo.com/mdeditor">本文内容是引用学习 markdown 语法手册</a></h4><p>我们理解您需要更便捷更高效的工具记录思想，整理笔记、知识，并将其中承载的价值传播给他人，<strong>Cmd Markdown</strong> 是我们给出的答案 —— 我们为记录思想和分享知识提供更专业的工具。 您可以使用 Cmd Markdown：</p><blockquote><ul><li>整理知识，学习笔记</li><li>发布日记，杂文，所见所想</li><li>撰写发布技术文稿（代码支持）</li><li>撰写发布学术论文（LaTeX 公式支持）</li></ul></blockquote><p><img src="https://www.zybuluo.com/static/img/logo.png" alt="cmd-markdown-logo"></p><p>除了您现在看到的这个 Cmd Markdown 在线版本，您还可以前往以下网址下载：</p><h3 id="Windows-Mac-Linux-全平台客户端"><a href="#Windows-Mac-Linux-全平台客户端" class="headerlink" title="Windows&#x2F;Mac&#x2F;Linux 全平台客户端"></a><a href="https://www.zybuluo.com/cmd/">Windows&#x2F;Mac&#x2F;Linux 全平台客户端</a></h3><blockquote><p>请保留此份 Cmd Markdown 的欢迎稿兼使用说明，如需撰写新稿件，点击顶部工具栏右侧的 <i class="icon-file"></i> <strong>新文稿</strong> 或者使用快捷键 <code>Ctrl+Alt+N</code>。</p></blockquote><hr><h2 id="什么是-Markdown"><a href="#什么是-Markdown" class="headerlink" title="什么是 Markdown"></a>什么是 Markdown</h2><p>Markdown 是一种方便记忆、书写的纯文本标记语言，用户可以使用这些标记符号以最小的输入代价生成极富表现力的文档：譬如您正在阅读的这份文档。它使用简单的符号标记不同的标题，分割不同的段落，<strong>粗体</strong> 或者 <em>斜体</em> 某些文字，更棒的是，它还可以</p><h3 id="1-制作一份待办事宜-Todo-列表"><a href="#1-制作一份待办事宜-Todo-列表" class="headerlink" title="1. 制作一份待办事宜 Todo 列表"></a>1. 制作一份待办事宜 <a href="https://www.zybuluo.com/mdeditor?url=https://www.zybuluo.com/static/editor/md-help.markdown#13-%E5%BE%85%E5%8A%9E%E4%BA%8B%E5%AE%9C-todo-%E5%88%97%E8%A1%A8">Todo 列表</a></h3><ul><li><input disabled="" type="checkbox"> 支持以 PDF 格式导出文稿</li><li><input disabled="" type="checkbox"> 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率</li><li><input checked="" disabled="" type="checkbox"> 新增 Todo 列表功能</li><li><input checked="" disabled="" type="checkbox"> 修复 LaTex 公式渲染问题</li><li><input checked="" disabled="" type="checkbox"> 新增 LaTex 公式编号功能</li></ul><h3 id="2-书写一个质能守恒公式-LaTeX"><a href="#2-书写一个质能守恒公式-LaTeX" class="headerlink" title="2. 书写一个质能守恒公式[^LaTeX]"></a>2. 书写一个质能守恒公式[^LaTeX]</h3><p>$$E&#x3D;mc^2$$</p><h3 id="3-高亮一段代码-code"><a href="#3-高亮一段代码-code" class="headerlink" title="3. 高亮一段代码[^code]"></a>3. 高亮一段代码[^code]</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@requires_authorization</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># A comment</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;hello world&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="4-高效绘制-流程图"><a href="#4-高效绘制-流程图" class="headerlink" title="4. 高效绘制 流程图"></a>4. 高效绘制 <a href="https://www.zybuluo.com/mdeditor?url=https://www.zybuluo.com/static/editor/md-help.markdown#7-%E6%B5%81%E7%A8%8B%E5%9B%BE">流程图</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs flow">st=&gt;start: Start<br>op=&gt;operation: Your Operation<br>cond=&gt;condition: Yes or No?<br>e=&gt;end<br><br>st-&gt;op-&gt;cond<br>cond(yes)-&gt;e<br>cond(no)-&gt;op<br></code></pre></td></tr></table></figure><h3 id="5-高效绘制-序列图"><a href="#5-高效绘制-序列图" class="headerlink" title="5. 高效绘制 序列图"></a>5. 高效绘制 <a href="https://www.zybuluo.com/mdeditor?url=https://www.zybuluo.com/static/editor/md-help.markdown#8-%E5%BA%8F%E5%88%97%E5%9B%BE">序列图</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs seq">Alice-&gt;Bob: Hello Bob, how are you?<br>Note right of Bob: Bob thinks<br>Bob--&gt;Alice: I am good thanks!<br></code></pre></td></tr></table></figure><h3 id="6-高效绘制-甘特图"><a href="#6-高效绘制-甘特图" class="headerlink" title="6. 高效绘制 甘特图"></a>6. 高效绘制 <a href="https://www.zybuluo.com/mdeditor?url=https://www.zybuluo.com/static/editor/md-help.markdown#9-%E7%94%98%E7%89%B9%E5%9B%BE">甘特图</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gantt">title 项目开发流程<br>section 项目确定<br>    需求分析       :a1, 2016-06-22, 3d<br>    可行性报告     :after a1, 5d<br>    概念验证       : 5d<br>section 项目实施<br>    概要设计      :2016-07-05  , 5d<br>    详细设计      :2016-07-08, 10d<br>    编码          :2016-07-15, 10d<br>    测试          :2016-07-22, 5d<br>section 发布验收<br>    发布: 2d<br>    验收: 3d<br></code></pre></td></tr></table></figure><h3 id="7-绘制表格"><a href="#7-绘制表格" class="headerlink" title="7. 绘制表格"></a>7. 绘制表格</h3><table><thead><tr><th>项目</th><th align="right">价格</th><th align="center">数量</th></tr></thead><tbody><tr><td>计算机</td><td align="right">$1600</td><td align="center">5</td></tr><tr><td>手机</td><td align="right">$12</td><td align="center">12</td></tr><tr><td>管线</td><td align="right">$1</td><td align="center">234</td></tr></tbody></table><h3 id="8-更详细语法说明"><a href="#8-更详细语法说明" class="headerlink" title="8. 更详细语法说明"></a>8. 更详细语法说明</h3><p>想要查看更详细的语法说明，可以参考我们准备的 [Cmd Markdown 简明语法手册][1]，进阶用户可以参考 [Cmd Markdown 高阶语法手册][2] 了解更多高级功能。</p><p>总而言之，不同于其它 <em>所见即所得</em> 的编辑器：你只需使用键盘专注于书写文本内容，就可以生成印刷级的排版格式，省却在键盘和工具栏之间来回切换，调整内容和格式的麻烦。<strong>Markdown 在流畅的书写和印刷级的阅读体验之间找到了平衡。</strong> 目前它已经成为世界上最大的技术分享网站 GitHub 和 技术问答网站 StackOverFlow 的御用书写格式。</p><hr><h2 id="什么是-Cmd-Markdown"><a href="#什么是-Cmd-Markdown" class="headerlink" title="什么是 Cmd Markdown"></a>什么是 Cmd Markdown</h2><p>您可以使用很多工具书写 Markdown，但是 Cmd Markdown 是这个星球上我们已知的、最好的 Markdown 工具——没有之一 ：）因为深信文字的力量，所以我们和你一样，对流畅书写，分享思想和知识，以及阅读体验有极致的追求，我们把对于这些诉求的回应整合在 Cmd Markdown，并且一次，两次，三次，乃至无数次地提升这个工具的体验，最终将它演化成一个 <strong>编辑&#x2F;发布&#x2F;阅读</strong> Markdown 的在线平台——您可以在任何地方，任何系统&#x2F;设备上管理这里的文字。</p><h3 id="1-实时同步预览"><a href="#1-实时同步预览" class="headerlink" title="1. 实时同步预览"></a>1. 实时同步预览</h3><p>我们将 Cmd Markdown 的主界面一分为二，左边为<strong>编辑区</strong>，右边为<strong>预览区</strong>，在编辑区的操作会实时地渲染到预览区方便查看最终的版面效果，并且如果你在其中一个区拖动滚动条，我们有一个巧妙的算法把另一个区的滚动条同步到等价的位置，超酷！</p><h3 id="2-编辑工具栏"><a href="#2-编辑工具栏" class="headerlink" title="2. 编辑工具栏"></a>2. 编辑工具栏</h3><p>也许您还是一个 Markdown 语法的新手，在您完全熟悉它之前，我们在 <strong>编辑区</strong> 的顶部放置了一个如下图所示的工具栏，您可以使用鼠标在工具栏上调整格式，不过我们仍旧鼓励你使用键盘标记格式，提高书写的流畅度。</p><p><img src="https://www.zybuluo.com/static/img/toolbar-editor.png" alt="tool-editor"></p><h3 id="3-编辑模式"><a href="#3-编辑模式" class="headerlink" title="3. 编辑模式"></a>3. 编辑模式</h3><p>完全心无旁骛的方式编辑文字：点击 <strong>编辑工具栏</strong> 最右侧的拉伸按钮或者按下 <code>Ctrl + M</code>，将 Cmd Markdown 切换到独立的编辑模式，这是一个极度简洁的写作环境，所有可能会引起分心的元素都已经被挪除，超清爽！</p><h3 id="4-实时的云端文稿"><a href="#4-实时的云端文稿" class="headerlink" title="4. 实时的云端文稿"></a>4. 实时的云端文稿</h3><p>为了保障数据安全，Cmd Markdown 会将您每一次击键的内容保存至云端，同时在 <strong>编辑工具栏</strong> 的最右侧提示 <code>已保存</code> 的字样。无需担心浏览器崩溃，机器掉电或者地震，海啸——在编辑的过程中随时关闭浏览器或者机器，下一次回到 Cmd Markdown 的时候继续写作。</p><h3 id="5-离线模式"><a href="#5-离线模式" class="headerlink" title="5. 离线模式"></a>5. 离线模式</h3><p>在网络环境不稳定的情况下记录文字一样很安全！在您写作的时候，如果电脑突然失去网络连接，Cmd Markdown 会智能切换至离线模式，将您后续键入的文字保存在本地，直到网络恢复再将他们传送至云端，即使在网络恢复前关闭浏览器或者电脑，一样没有问题，等到下次开启 Cmd Markdown 的时候，她会提醒您将离线保存的文字传送至云端。简而言之，我们尽最大的努力保障您文字的安全。</p><h3 id="6-管理工具栏"><a href="#6-管理工具栏" class="headerlink" title="6. 管理工具栏"></a>6. 管理工具栏</h3><p>为了便于管理您的文稿，在 <strong>预览区</strong> 的顶部放置了如下所示的 <strong>管理工具栏</strong>：</p><p><img src="https://www.zybuluo.com/static/img/toolbar-manager.jpg" alt="tool-manager"></p><p>通过管理工具栏可以：</p><p><i class="icon-share"></i> 发布：将当前的文稿生成固定链接，在网络上发布，分享<br><i class="icon-file"></i> 新建：开始撰写一篇新的文稿<br><i class="icon-trash"></i> 删除：删除当前的文稿<br><i class="icon-cloud"></i> 导出：将当前的文稿转化为 Markdown 文本或者 Html 格式，并导出到本地<br><i class="icon-reorder"></i> 列表：所有新增和过往的文稿都可以在这里查看、操作<br><i class="icon-pencil"></i> 模式：切换 普通&#x2F;Vim&#x2F;Emacs 编辑模式</p><h3 id="7-阅读工具栏"><a href="#7-阅读工具栏" class="headerlink" title="7. 阅读工具栏"></a>7. 阅读工具栏</h3><p><img src="https://www.zybuluo.com/static/img/toolbar-reader.jpg" alt="tool-manager"></p><p>通过 <strong>预览区</strong> 右上角的 <strong>阅读工具栏</strong>，可以查看当前文稿的目录并增强阅读体验。</p><p>工具栏上的五个图标依次为：</p><p><i class="icon-list"></i> 目录：快速导航当前文稿的目录结构以跳转到感兴趣的段落<br><i class="icon-chevron-sign-left"></i> 视图：互换左边编辑区和右边预览区的位置<br><i class="icon-adjust"></i> 主题：内置了黑白两种模式的主题，试试 <strong>黑色主题</strong>，超炫！<br><i class="icon-desktop"></i> 阅读：心无旁骛的阅读模式提供超一流的阅读体验<br><i class="icon-fullscreen"></i> 全屏：简洁，简洁，再简洁，一个完全沉浸式的写作和阅读环境</p><h3 id="8-阅读模式"><a href="#8-阅读模式" class="headerlink" title="8. 阅读模式"></a>8. 阅读模式</h3><p>在 <strong>阅读工具栏</strong> 点击 <i class="icon-desktop"></i> 或者按下 <code>Ctrl+Alt+M</code> 随即进入独立的阅读模式界面，我们在版面渲染上的每一个细节：字体，字号，行间距，前背景色都倾注了大量的时间，努力提升阅读的体验和品质。</p><h3 id="9-标签、分类和搜索"><a href="#9-标签、分类和搜索" class="headerlink" title="9. 标签、分类和搜索"></a>9. 标签、分类和搜索</h3><p>在编辑区任意行首位置输入以下格式的文字可以标签当前文档：</p><p>标签： 未分类</p><p>标签以后的文稿在【文件列表】（Ctrl+Alt+F）里会按照标签分类，用户可以同时使用键盘或者鼠标浏览查看，或者在【文件列表】的搜索文本框内搜索标题关键字过滤文稿，如下图所示：</p><p><img src="https://www.zybuluo.com/static/img/file-list.png" alt="file-list"></p><h3 id="10-文稿发布和分享"><a href="#10-文稿发布和分享" class="headerlink" title="10. 文稿发布和分享"></a>10. 文稿发布和分享</h3><p>在您使用 Cmd Markdown 记录，创作，整理，阅读文稿的同时，我们不仅希望它是一个有力的工具，更希望您的思想和知识通过这个平台，连同优质的阅读体验，将他们分享给有相同志趣的人，进而鼓励更多的人来到这里记录分享他们的思想和知识，尝试点击 <i class="icon-share"></i> (Ctrl+Alt+P) 发布这份文档给好友吧！</p><hr>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySql 日常</title>
    <link href="/2024/03/19/MySqlAbout/"/>
    <url>/2024/03/19/MySqlAbout/</url>
    
    <content type="html"><![CDATA[<h2 id="MySql-常用指南"><a href="#MySql-常用指南" class="headerlink" title="MySql  常用指南"></a>MySql  常用指南</h2><p>MySql 日常使用命令汇总</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">DDL（data definition <span class="hljs-keyword">language</span>）数据定义语言，用户定义和管理<span class="hljs-keyword">sql</span>数据库中所有对象的语言。<br>DML（data manipulation <span class="hljs-keyword">language</span>）数据操作语言。<br>DCL（<span class="hljs-type">date</span> control <span class="hljs-keyword">language</span>）数据库控制功能。<br></code></pre></td></tr></table></figure><h3 id="数据库对象"><a href="#数据库对象" class="headerlink" title="数据库对象"></a>数据库对象</h3><p>&emsp;&emsp;数据库对象是数据库的组成部分，常见的有以下几种：表（Table ）、索引（Index）、视图（View）、图表（Diagram）、缺省值（Default）、规则（Rule）、触发器（Trigger）、存储过程（Stored Procedure）、 用户（User）等。 命名规范是指数据库对象如数据库（SCHEMA）、表（TABLE）、索引（INDEX）、约束（CONSTRAINTS）等的命名约定。</p><h3 id="数据库对象全局命名规范"><a href="#数据库对象全局命名规范" class="headerlink" title="数据库对象全局命名规范"></a>数据库对象全局命名规范</h3><blockquote><ol><li>命名使用具有意义的英文词汇，词汇中间以下划线分隔</li><li>命名只能使用英文字母、数字、下划线，以英文字母开头</li><li>避免用MySQL的保留字如：backup、call、group等，参考MySQL 5.7+的关键字和保留字。</li><li>所有数据库对象使用小写字母，实际上MySQL中是可以设置大小写是否敏感的，为了保证统一性，我们这边规范全部小写表示。</li></ol></blockquote><h3 id="数据库命名规范"><a href="#数据库命名规范" class="headerlink" title="数据库命名规范"></a>数据库命名规范</h3><blockquote><ol><li>数据库命名尽量不超过30个字符。</li><li>数据库命名一般为项目名称+代表库含义的简写，比如IM项目的工作流数据库，可以是 im_flow。</li><li>数据库创建时必须添加默认字符集和校对规则子句。默认字符集为UTF8（已迁移dumbo的使用utf8mb4）</li></ol></blockquote><h3 id="表命名规范"><a href="#表命名规范" class="headerlink" title="表命名规范"></a>表命名规范</h3><blockquote><ol><li>常规表表名以t_开头，t代表table的意思，命名规则即 t + 模块（包含模块含义的简写）+ 表（包含表含义的简写），比如用户模块的教育信息表：t_user_eduinfo。</li><li>临时表（RD、QA或DBA同学用于数据临时处理的表），命名规则：temp前缀+模块+表+日期后缀：temp_user_eduinfo_20210719</li><li>备份表（用于保存和归档历史数据或者作为灾备恢复的数据）命名规则，bak前缀+模块+表+日期后缀：bak_user_eduinfo_20210719</li><li>同一个模块的表尽可能使用相同的前缀，表名称尽可能表达含义</li><li>多个单词以下划线 _ 分隔</li><li>常规表表名尽量不超过30个字符，temp表和bak表视情况而定，也尽量简短为宜，命名应使用小写</li></ol></blockquote><h3 id="字段命名规范"><a href="#字段命名规范" class="headerlink" title="字段命名规范"></a>字段命名规范</h3><blockquote><ol><li>字段命名需要表示其实际含义的英文单词或简写，单词之间用下划线 _ 进行连接，如 service_ip、service_port。</li><li>各表之间相同意义的字段必须同名，比如a表和b表都有创建时间，应该统一为create_time，不一致会很混乱。</li><li>多个单词以下划线 _ 分隔</li><li>字段名尽量不超过30个字符，命名应该使用小写</li><li>命名应使用小写。</li></ol></blockquote><h3 id="索引命名规范"><a href="#索引命名规范" class="headerlink" title="索引命名规范"></a>索引命名规范</h3><blockquote><ol><li>唯一索引使用uni + 字段名 来命名： create unique index uni_uid on t_user_basic(uid) 。</li><li>非唯一索引使用idx + 字段名 来命名： create index idx_uname_mobile on t_user_basic(uname,mobile) 。</li><li>多个单词以下划线 _ 分隔。</li><li>索引名尽量不超过50个字符，命名应该使用小写，组合索引的字段不宜太多，不然也不利于查询效率的提升。</li><li>多单词组成的列名，取尽可能代表意义的缩写，如 test_contact表member_id和friend_id上的组合索引：idx_mid_fid。</li><li>理解组合索引最左前缀原则，避免重复建设索引，如果建立了(a,b,c)，相当于建立了(a), (a,b), (a,b,c)。</li></ol></blockquote><h3 id="视图命名规范"><a href="#视图命名规范" class="headerlink" title="视图命名规范"></a>视图命名规范</h3><blockquote><ol><li>视图名以v开头，表示view，完整结构是v+视图内容含义缩写。</li><li>如果视图只来源单个表，则为v+表名。如果视图由几个表关联产生就用v+下划线（_）连接几个表名，视图名尽量不超过30个字符。如超过30个字符则取简写。</li><li>如无特殊需要，严禁开发人员创建视图。</li><li>命名应使用小写。</li></ol></blockquote><h3 id="存储过程命名规范"><a href="#存储过程命名规范" class="headerlink" title="存储过程命名规范"></a>存储过程命名规范</h3><blockquote><ol><li>存储过程名以sp开头，表示存储过程（storage procedure）。之后多个单词以下划线（_）进行连接。存储过程命名中应体现其功能。存储过程名尽量不能超过30个字符。</li><li>存储过程中的输入参数以i_开头，输出参数以o_开头。</li><li>命名应使用小写。<br>create procedure sp_multi_param(in i_id bigint,in i_name varchar(32),out o_memo varchar(100))</li></ol></blockquote><h3 id="函数命名规范"><a href="#函数命名规范" class="headerlink" title="函数命名规范"></a>函数命名规范</h3><blockquote><ol><li>函数名以func开始，表示function。之后多个单词以下划线（_）进行连接，函数命名中应体现其功能。函数名尽量不超过30个字符。</li><li>命名应使用小写。<br>create function func_format_date(ctime datetime)</li></ol></blockquote><h3 id="触发器命名规范"><a href="#触发器命名规范" class="headerlink" title="触发器命名规范"></a>触发器命名规范</h3><blockquote><ol><li>触发器以trig开头，表示trigger 触发器。</li><li>基本部分，描述触发器所加的表，触发器名尽量不超过30个字符。</li><li>后缀（_i,_u,_d）,表示触发条件的触发方式（insert,update或delete）。</li><li>命名应使用小写。</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TRIGGER</span> IF <span class="hljs-keyword">EXISTS</span> trig_attach_log_d;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> trig_attach_log_d AFTER <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> t_dept <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span>;<br></code></pre></td></tr></table></figure><h3 id="约束命名规范"><a href="#约束命名规范" class="headerlink" title="约束命名规范"></a>约束命名规范</h3><blockquote><ol><li>唯一约束：uk_表名称_字段名。uk是UNIQUE KEY的缩写。比如给一个部门的部门名称加上唯一约束，来保证不重名，如下：ALTER TABLE t_dept ADDCONSTRAINT un_name UNIQUE(name);</li><li>外键约束：fk_表名，后面紧跟该外键所在的表名和对应的主表名（不含t_）。子表名和父表名用下划线(_)分隔。如下： ALTER TABLE t_user ADDCONSTRAINT fk_user_dept FOREIGN KEY(depno) REFERENCES t_dept (id);</li><li>非空约束：如无特殊需要，建议所有字段默认非空(not null)，不同数据类型必须给出默认值(default)。</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span> `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br><span class="hljs-number">2</span> `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span>,<br><span class="hljs-number">3</span> `deptId` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br><span class="hljs-number">4</span> `salary` <span class="hljs-type">float</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br></code></pre></td></tr></table></figure><blockquote><p>4 出于性能考虑，如无特殊需要，建议不使用外键。参照完整性由代码控制。这个也是我们普遍的做法，从程序角度进行完整性控制，但是如果不注意，也会产生脏数据。</p></blockquote><h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span><span class="hljs-operator">/</span><span class="hljs-keyword">alter</span><span class="hljs-operator">/</span><span class="hljs-keyword">drop</span>  <br>以上过于基础，忽略；<br></code></pre></td></tr></table></figure><h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> version();   查看当前版本<br><br></code></pre></td></tr></table></figure><h3 id="DML-1"><a href="#DML-1" class="headerlink" title="DML"></a>DML</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>About hexo</title>
    <link href="/2024/03/19/hello-world/"/>
    <url>/2024/03/19/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.<br><a href="https://hexo.io/themes/">https://hexo.io/themes/</a></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><p>this is about Hexo dev document.  </p><h3 id="Hexo-dev-document-hexo-配置说明"><a href="#Hexo-dev-document-hexo-配置说明" class="headerlink" title="Hexo dev document(hexo 配置说明)"></a><a href="https://hexo.fluid-dev.com/">Hexo dev document(hexo 配置说明)</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>如何搭建DBT开发环境</title>
    <link href="/2024/03/19/secondArticle/"/>
    <url>/2024/03/19/secondArticle/</url>
    
    <content type="html"><![CDATA[<h2 id="DBT-环境搭建步骤"><a href="#DBT-环境搭建步骤" class="headerlink" title="DBT 环境搭建步骤"></a>DBT 环境搭建步骤</h2><h3 id="第一步：准备pathon-虚拟环境"><a href="#第一步：准备pathon-虚拟环境" class="headerlink" title="第一步：准备pathon 虚拟环境"></a>第一步：准备pathon 虚拟环境</h3><p>1、python  安装版本为3.9.9；<br>DBT 环境搭建步骤： 【参考Python环境搭建】 <a href="https://blog.csdn.net/mghoumin/article/details/126911677">https://blog.csdn.net/mghoumin/article/details/126911677</a><br>1.1创建python 虚拟环境<br>python -m venv python3.7.8_env</p><p><img src="/img/1.jpg" alt="Example Image" title="Example Title"></p><p>1.2 激活虚拟环境<br>首先到Scripts目录下<br>执行 .\Activate.psl</p><p><img src="/img/2.jpg" alt="Example Image" title="Example Title"></p><p>1.3 激活虚拟环境失败需要设置windows 安全策略用管理员模式运行 Windows PowerShell ， 然后输入get-ExecutionPolicy 取得shell的当前执行策 略，看到返回了 Restricted 默认值</p><p><img src="/img/3.jpg" alt="Example Image" title="Example Title"></p><p>设置策略 set-ExecutionPolicy RemoteSigned</p><p><img src="/img/4.jpg" alt="Example Image" title="Example Title"></p><p>2、配置激活python 虚拟环境；<br>Windows系统：.\Scripts\activate<br>MacOS和Linux系统：source bin&#x2F;activate</p><p>3、安装pip 依赖包</p><h3 id="第二步：安装DBT"><a href="#第二步：安装DBT" class="headerlink" title="第二步：安装DBT"></a>第二步：安装DBT</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">pip  <span class="hljs-keyword">instal </span>dbt<br>pip  <span class="hljs-keyword">install </span>dbt-doris<br></code></pre></td></tr></table></figure><h3 id="第三步：运行DBT"><a href="#第三步：运行DBT" class="headerlink" title="第三步：运行DBT"></a>第三步：运行DBT</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">1、进入python 虚拟环境 执行 <span class="hljs-string">./Active/Scripts.bat</span><br>2、运行DBT dbt debug <span class="hljs-params">--profiles-dir</span> <span class="hljs-string">./</span>    <br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>技术分享</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
